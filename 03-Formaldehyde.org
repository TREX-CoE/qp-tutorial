#+TITLE: Frozen-Core FCI Calculations using CIPSI
#+AUTHOR: Anthony Scemama
#+LANGUAGE:  en
#+HTML_LINK_UP: 02-N2.html
#+HTML_LINK_HOME: index.html
#+SETUPFILE: org-html-themes/org/theme-readtheorg-local.setup
#+PROPERTY: header-args :exports code :eval no


In this part of the tutorial, you will learn how to perform
excited state calculations using the Configuration Interaction by
Perturbation of the Single-determinant (CIPSI) algorithm in Quantum
Package (QP). As an illustration, we will compute the energies of the
two lowest excited states of the formaldehyde molecule in the aug-cc-pVDZ
basis set.

   [[./images/formaldehyde.png]]

The following table displays, in eV, the theoretical best estimates (TBE) of the
excitation energies of formaldehyde.
$V$ denotes valence states, and $R$ denotes Rydberg states.
The data are taken from https://pubs.acs.org/doi/10.1021/acs.jctc.8b00406 .

| Transition                                                                                                                | TBE (eV) |
|---------------------------------------------------------------------------------------------------------------------------+----------|
| $1\:^{1}\mathrm{A_1} \rightarrow 1\:^{1}\mathrm{A_2}  (\mathrm{V};n \rightarrow \pi^\star)$                               |     3.97 |
| $1\:^{1}\mathrm{A_1} \rightarrow 1\:^{1}\mathrm{B_2}  (\mathrm{R};n \rightarrow 3s)$                                      |      7.3 |
| $1\:^{1}\mathrm{A_1} \rightarrow 2\:^{1}\mathrm{B_2}  (\mathrm{R};n \rightarrow 3p)$                                      |     8.14 |
| $1\:^{1}\mathrm{A_1} \rightarrow 2\:^{1}\mathrm{A_1}  (\mathrm{R};n \rightarrow 3p)$                                      |     8.27 |
| $1\:^{1}\mathrm{A_1} \rightarrow 2\:^{1}\mathrm{A_2}  (\mathrm{R};n \rightarrow 3p)$                                      |      8.5 |
| $1\:^{1}\mathrm{A_1} \rightarrow 1\:^{1}\mathrm{B_1}  (\mathrm{V})$                                                       |     9.21 |
| $1\:^{1}\mathrm{A_1} \rightarrow 3\:^{1}\mathrm{A_1}  (\mathrm{V};\pi \rightarrow \pi^\star)$                             |     9.26 |
| $1\:^{1}\mathrm{A_1} \rightarrow 1\:^{3}\mathrm{A_2}  (\mathrm{V};n \rightarrow \pi^\star)$                               |     3.58 |
| $1\:^{1}\mathrm{A_1} \rightarrow 1\:^{3}\mathrm{A_1}  (\mathrm{V};\pi \rightarrow \pi^\star)$                             |     6.07 |
| $1\:^{1}\mathrm{A_1} \rightarrow 1\:^{3}\mathrm{B_2}  (\mathrm{R};n \rightarrow 3s)$                                      |     7.14 |
| $1\:^{1}\mathrm{A_1} \rightarrow 2\:^{3}\mathrm{B_2}  (\mathrm{R};n \rightarrow 3p)$                                      |     7.96 |
| $1\:^{1}\mathrm{A_1} \rightarrow 2\:^{3}\mathrm{A_1}  (\mathrm{R};n \rightarrow 3p)$                                      |     8.15 |
| $1\:^{1}\mathrm{A_1} \rightarrow 1\:^{3}\mathrm{B_1}  (\mathrm{R})$                                                       |     8.42 |
| $1\:^{1}\mathrm{A^\prime} \rightarrow 1\:^{1}\mathrm{A^{\prime\prime}} [\mathrm{F}] (\mathrm{V};n \rightarrow \pi^\star)$ |      2.8 |


* Preparing the EZFIO

  First, let's create an ~xyz~ file for formaldehyde, in Angstroms:

  #+begin_src text :tangle formaldehyde.xyz
4
Formaldehyde
C       0.00000000       0.00000000      -0.60298508
O       0.00000000       0.00000000       0.60539399
H       0.00000000       0.93467313      -1.18217476
H       0.00000000      -0.93467313      -1.18217476
  #+end_src

  Next, create an EZFIO database containing the geometry and the basis
  set parameters for the aug-cc-pVDZ basis set, and run the Hartree-Fock
  calculation.

  #+begin_src bash
qp create_ezfio -b aug-cc-pvdz formaldehyde.xyz
qp run scf | tee formaldehyde.scf.out
qp set_frozen_core
  #+end_src

  The expected Hartree-Fock energy is -113.87599164 au.

  #+begin_note
Excited states generally have diffuse character. To accurately
describe excited states, it is necessary to use a basis set that
includes diffuse atomic basis functions. Diffuse functions are
orbitals that are spatially extended beyond the region where the
valence electrons are found.

When excited states are computed using a basis set that lacks diffuse
functions, the computed wavefunctions may have insufficiently diffuse
character and be of lower quality, resulting in overestimated 
excited-state energies and inaccurate properties.
  #+end_note

* Multi-state CIPSI calculation with Hartree-Fock orbitals

  To enable the calculation of multiple states, you can use ~qp
  set determinants n_states~. In this section, we will compute the
  ground state and the two lowest states of formaldehyde, namely three
  states:

  #+begin_src bash
qp set determinants n_states 3
qp set determinants n_det_max 100000
qp run fci | tee formaldehyde.fci1.out
  #+end_src
